esphome:
  name: seeed-sensecap
  friendly_name: Seeed SenseCAP

substitutions:
  <<: !include theme/defaults.yaml
  font_id: "libreFranklin25Light"
  font_id_small: "libreFranklin16"
  font_id_large: "libreFranklin32"

esp32:
  variant: esp32s3
  flash_size: 8MB
  framework:
    type: esp-idf
    sdkconfig_options:
      CONFIG_ESPTOOLPY_FLASHSIZE_8MB: y
      CONFIG_ESP32S3_DEFAULT_CPU_FREQ_240: y
      CONFIG_ESP32S3_DATA_CACHE_64KB: y
      CONFIG_SPIRAM_FETCH_INSTRUCTIONS: y
      CONFIG_SPIRAM_RODATA: y

psram:
  mode: octal
  speed: 80MHz

logger:
  hardware_uart: UART0
  level: DEBUG

font: !include theme/fonts.yaml

output:
  - platform: ledc
    pin:
      number: GPIO45
      ignore_strapping_warning: true
    id: ledc_gpio45
    frequency: 100Hz

binary_sensor:
  - platform: gpio
    pin:
      number: GPIO38
      inverted: true
    name: "User Button"

i2c:
  - id: bus_a
    sda: GPIO39
    scl: GPIO40
    scan: false

spi:
  - id: lcd_spi
    clk_pin: GPIO41
    mosi_pin: GPIO48
    miso_pin: GPIO47

pca9554:
  - id: pca9554a_device
    address: 0x20
    pin_count: 16

display:
  - platform: mipi_rgb
    model: SEEED-INDICATOR-D1
    id: sensecap_display

light:
  - platform: monochromatic
    name: "Backlight"
    id: backlight
    output: ledc_gpio45
    restore_mode: ALWAYS_ON

touchscreen:
  platform: ft5x06
  id: sensecap_touchscreen
  transform:
    mirror_x: true
    mirror_y: true
  on_release:
    - if:
        condition: lvgl.is_paused
        then:
          - lvgl.resume:
          - lvgl.widget.redraw:
          - light.turn_on: backlight

image:
  - file: https://esphome.io/favicon-512x512.png
    id: boot_logo
    resize: 200x200
    type: RGB565
    transparency: alpha_channel

# LVGL Implementation
lvgl:
  log_level: DEBUG
  
  # Pull in styles
  style_definitions: !include theme/style.yaml

  pages:
    - id: main_page
      bg_color: ${color_bg}
      widgets:
        - tabview:
            id: main_tabs
            position: ${tab_pos}
            width: ${screen_width}
            height: ${screen_height}
            
            tabs:
              - name: Home
                widgets:
                  - obj:
                      width: 100%
                      height: 100%
                      layout:
                        type: grid
                        grid_columns: ["45%", "45%"]
                        grid_rows: ["45%", "45%"]
                        pad_column: ${grid_gap}
                        pad_row: ${grid_gap}
                      widgets:
                        # Widget 1: Clock
                        - <<: !include 
                            file: widgets/clock.yaml
                            vars:
                              widget_id: main_clock
                              font_id: ${font_id_large}
                        
                        # Widget 2: Weather
                        - <<: !include 
                            file: widgets/weather.yaml
                            vars:
                              widget_id: main_weather
                              font_id: ${font_id}
                              font_id_small: ${font_id_small}
              
              - name: Controls
                widgets:
                  - label:
                      text: "Controls Page"
                      align: CENTER

